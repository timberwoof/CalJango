CalJango Notes

Python version installed
Timberden:~ timberwoof$ python --version
Python 2.7.12

https://docs.djangoproject.com/en/1.11/faq/install/#faq-python-version-support
says Django 1.11 supports Python 2.7, 3.4, 3.5, 3.6

If you’re starting a new project, and the dependencies you plan to use work on Python 3, you should use Python 3. If they don’t, consider contributing to the porting efforts, or stick to Python 2.

So upgrade python to latest. 

https://www.macobserver.com/tmo/article/how-to-upgrade-your-mac-to-python-3

Download Python 3.4.1

Fix the fucking TextEdit problem. 1/2 hour on this fucking problem.
sudo codesign -f -s - /Applications/TextEdit.app/
not permitted

rm -rf ~/Library/Autosave\ Information/
Doesn't fucking work. 

sudo diskutil repairPermissions /
Doesn't work any more

rm ~/Library/Preferences/com.apple.TextEdit.LSSharedFileList.plist
Didn't solve the problem

https://www.python.org/downloads/

Timberden:~ timberwoof$ python3
Python 3.6.1 (v3.6.1:69c0db5050, Mar 21 2017, 01:21:04) 
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin


Install jango
pip install Django==1.11.2


Successfully installed Django-1.11.2 pytz-2017.2
You are using pip version 8.1.2, however version 9.0.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
Timberden:~ timberwoof$ 
FUCK ME!
Which will not care until the next time I use pip, by which time this version will be out of date. 


https://docs.djangoproject.com/en/1.11/intro/install/

set up a database. 
mysql is installed - uninstalled. 

https://docs.djangoproject.com/en/1.11/topics/install/#database-installation
SQLite or PostgreSQL or MySQL? 

SQLite
https://www.sqlite.org/download.html

https://docs.djangoproject.com/en/1.11/ref/databases/#sqlite-notes

20160604==============

cd mysite
python manage.py runserver
http://127.0.0.1:8000
It worked!
Congratulations on your first Django-powered page.
python manage.py startapp calendar
CommandError: 'calendar' conflicts with the name of an existing Python module and cannot be used as an app name. Please try another name.

python manage.py startapp zulucal
works

database setup ... settings.py is already set up for sqlite3

********* Migration Process: ***********
python manage.py makemigrations zulucal
python manage.py sqlmigrate zulucal 0003 --- needs to be incremented every time
python manage.py migrate
python manage.py runserver


Models are substantially set up.
They relate to each other reasonably well.
Some of the fields show up in the admin site.
• Need to make special views so the objects will be fully editable.

CalendarList
CalendarDetail

personList
personDetail

placeList
placeDetail

thingList
thingDetail

eventList
eventDetail

eventRelationList
eventRelationDetail

URLS
/zulucal/
/zulucal/calendars/
/zulucal/calendars/5/
/zulucal/persons/
/zulucal/persons/5/
/zulucal/places/
/zulucal/places5/
/zulucal/events/
/zulucal/events/5/
/zulucal/relations/
/zulucal/relations/5/
============
20171128

Need to get some standard toys for showing basic fieldlike things. 

https://docs.djangoproject.com/en/1.11/topics/templates/
https://www.wired.com/2010/02/use_templates_in_django/
https://docs.djangoproject.com/en/dev/ref/templates/builtins/
https://tutorial.djangogirls.org/en/django_templates/


Django Views
*****
https://docs.djangoproject.com/en/1.11/topics/class-based-views/generic-display/
https://docs.djangoproject.com/en/1.11/ref/class-based-views/

ListView
DetailView
FormView
CreateView
UpdateView
DeleteView

======
2018-03-10

cd /Users/timberwoof/Dev/CalJango/mysite
python manage.py runserver

http://127.0.0.1:8000/admin/login/?next=/admin/zulucal/

Calendars
Event relations
Events
Persons
Places
Things

Calendars have
Name
Description
BaseCalendar
** Need date in base calendar

Things have
name
description
Panoculus page


Persons have
name
description
Panoculus page


Places have
name
description
Panoculus page


Events have
Calendar (1 is ok)
Person (needs more than one!)
Place (needs 1)
Thing (needs more than one!)
Description (1 is ok)
URL (1 is ok)
earliest, latest, pinned


Event Relations
First Event
Second Event
intervalMin
intervalMax

======
Needs identified
• calendars need dates in base calendar - calendarOffset
• events need more than one person, more than one thing,  possibly more than one place
• events need to let user edit earliest, latest, pinned

• event relations need to let user edit min, max time between

——
After reinstall the OS on the lappy. 
Does this editor still cry about permissions? Yes
    
Edit edit edit d
more edit save
===========
2018-05-12 status
Django home page has admin stuff

Zulucal Administration has
Calendars
Event Relations
Events
Persons
Places
Things

Each of these has a page that lets you add or delete objects, or open an edit window into a thing. 
The database is there and persistent. 
There is a Git repository, not connected to anything. 
• need to link this to my github. 

• need to calculate crap
• need to display calendar


Event: calendar, person, place, thing, description, link

Event: person, place, thing are not required. Use Nobody, Nowhere, Nothing

*** event names are not right: need to add the thing
use with and at
of "nothing" then omit the thing
person (NOODY)
place (NOWHERE)
thing (NOTHING)
description
-- added better def __str__(self): function 


*** Event Relationships only have first and second event. 
Need before/after and duration range 
---the fields are there but donw't show up

event relationship names kind of suck
--- fixed names

====
migrations
$ python manage.py makemigrations zulucal
did not change the fields. 

I changed the URLS in the default URL fields, then tan 
$ python manage.py makemigrations zulucal
This results in migration 8
$ python manage.py sqlmigrate zulucal 0008
$ python manage.py migrate
$ python manage.py runserver
... worked

So force the change. 
Comment out the fields I want to change, and migrate 

$ python manage.py makemigrations zulucal
no changes detected! WTFF
That's upgefucked

Changed names of fields to fieldDammit
run migration again
no changes detected! WTFF
That's upgefucked!

https://stackoverflow.com/questions/37370660/makemigrations-doesnt-detect-changes-in-model
suggests
$ python manage.py makemigrations zulucal --initial

lotta help that is! 
Timberden:mysite timberwoof$ python manage.py makemigrations zulucal --initial
usage: manage.py makemigrations [-h] [--version] [-v {0,1,2,3}]
                                [--settings SETTINGS]
                                [--pythonpath PYTHONPATH] [--traceback]
                                [--no-color] [--dry-run] [--merge] [--empty]
                                [--noinput] [-n NAME] [-e] [--check]
                                [app_label [app_label ...]]
manage.py makemigrations: error: unrecognized arguments: --initial




https://stackoverflow.com/questions/32518804/django-makemigrations-not-detecting-new-model

You have to run python manage.py makemigrations first, 
Second, you have to run python manage.py migrate to sync db.

Well, I did. It does not work. 


added 
from .models import Calendar, Person, Place, Thing, Event, EventRelation
to __init__.py and got lovely error: 
django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.
Well, that's stupid

code was
    earliest = models.IntegerField
    latest = models.IntegerField
    pinned = models.BooleanField
hanged to
    earliest = models.IntegerField()
    latest = models.IntegerField()
    pinned = models.BooleanField()
which complained nicely about no init values
Taht worked and created migration 9

$ python manage.py sqlmigrate zulucal 0009
$ python manage.py migrate
$ python manage.py runserver

works! 

I entered about half the calendar that's on google docs. 

TO DO 
-- calculate the whole calendar
-- detect and flag errors
-- display the calendar (list events in order with some kind of earliest-latest bars)
1. simple text-only calendar
2. pretty graphics calendar with html graphics? 

••• any time there's a change to an event or to an event relation, recalculate starting at the the changed record. 

https://docs.djangoproject.com/en/2.0/topics/db/queries/



event
	calendar (offset from base)
	person (text)
	place (text)
	thing (text)
	description (text)
	url (text)
	earliest (integer) - input or output of calculation
	latest (integer) - input or output of calculation
	pinned (boolean) - if TRUE, earliest and latest are inputs
	- if FALSE, earliest and latest are results of calculations

eventRelation
	firstEvent (link to event)
	secondEvent (link to event)
	intervalMin (integer) - minimum detaT from first to second
	intervalMax (integer) - maximum detaT from first to second

••• add "recalculated" field to every non-pinned event


follows only a start at the calculation algorithm

Calculate all of them: 
for every pinned event
	for every previous-linked event
		pinnedEarliest - intervalMin
		pinnedLatest - intervalMin
		pinnedEarliest - intervalMax
		pinnedLatest - intervalMax
		-> min is newEarliest
		-> max is newLatest
		assert min <= max
		if previous-linked event is pinned:
			assert newEarliest >= previous.earliest 
			assert newEarliest <= previous.latest
			assert newLatest => previous.earliest
			assert newLatest <= previous.latest
		else 
			previous.earliest = newEarliest 
			previous.latest = newLatest
		set recalculated = true

	for every after-linked event
		pinnedEarliest + intervalMin
		pinnedLatest + intervalMin
		pinnedEarliest + intervalMax
		pinnedLatest + intervalMax
		-> min is newEarliest
		-> max is newLatest
		assert min <= max
		if after-linked event is pinned:
			assert newEarliest => after.earliest 
			assert newEarliest <= after.latest
			assert newLatest => after.earliest
			assert newLatest <= after.latest
		else 
			after.earliest = newEarliest 
			after.latest = newLatest
		set recalculated = true

for every non-pinned event where recalculated == false

The problem is that multiple events linked to this event may combine to determine its date and every influencing date needs to be calculated. 
Use the recalculated field to determine this. 
***Recursive descent into this crazy tree!***
I can set the dates of this event only when all linked events are calculated. 
There may be circular dependencies. 
Circular dependencies may appear and disappear based on relative dates. 

Calculate ONE event: 
For every previous-linked event: 
	If it is not pinned or calculated:
		calculate it.
	Get its earliest and latest dates, 
	combine with the link min and max intervals,
	and constrain this event's dates. 
For every subsequent-linked event: 
	If it is not pinned or calculated:
		calculate it.
	Get its earliest and latest dates, 
	combine with the link min and max intervals,
	and constrain this event's dates. 
mark this event calculated

Select pinned events sort by date:
for every event
	calculate it


django urlserver

^CTimberden:mysite timberwoof$ pwd
/Users/timberwoof/Dev/CalJango/mysite
Timberden:mysite timberwoof$ python manage.py runserver

nothing in manage.py obviously connects it to anything else

http://127.0.0.1:8000/
causes error. 

simplest defined url is
http://127.0.0.1:8000/admin/
http://127.0.0.1:8000/zulcal/

http://127.0.0.1:8000/admin/
gives Django Administration. Site Administration. Authentication and Authorization. Zulucal. 

http://127.0.0.1:8000/admin/zulucal/
gives Zulucal Administration. Zulucal. and all the objects, whose urls look like
http://127.0.0.1:8000/admin/zulucal/calendar/

http://127.0.0.1:8000/zulucal/
Hello, world. You're at the zulucal index.


mysite/zulucal/admin.py registers all the object types
mysite/zulucal/apps.py registers zulucal
mysite/zulucal/models.py defines the object models
mysite/zulucal/tests.py defines the tests, but there aren't any. 
mysite/zulucal/urls.py defines a bunch of stuff but all of it causes errors 
	Using the URLconf defined in mysite.urls
mysite/zulucal/views.py defines some stuff that's not accessed

mysite/urls.py has two urlpatterns
	zulucal/, include zulucal.urls
	admin/, include admin.sire.urls

http://127.0.0.1:8000/zulucal/events/5/
You're looking at event 5.

Aha!
so I need to make a thing that just displays these? 
But I don't care. I just need
recalculate
and 
display

https://docs.djangoproject.com/en/2.0/topics/http/urls/

https://docs.djangoproject.com/en/2.0/topics/db/queries/

